{"pageProps":{"postData":{"id":"asynchronous-javascript-trust-promise","content":"\nç»§å‰ç¯‡ [å¼‚æ­¥JavaScript-ç°åœ¨ä¸å°†æ¥ | ğŸ­Defectink](/defect/asynchronous-javascript-now-and-future.html) å¯¹å¼‚æ­¥ JavaScript æœ‰äº†ä¸ªå¤§æ¦‚çš„äº†è§£ä¹‹åï¼Œå°±è¦æ¥çœŸæ­£çš„ä¸Šæ‰‹ä¸€ä¸‹ Promise äº†ã€‚ä½†åœ¨äº†è§£ Promise è§£å†³äº†å“ªäº›é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬è¦å…ˆäº†è§£ä¸€ä¸‹ä¼ ç»Ÿçš„å›è°ƒä¼šå¸¦æ¥å“ªäº›é—®é¢˜ã€‚\n\n## å›è°ƒä¿¡ä»»é—®é¢˜\n\nå›è°ƒä¸ºä»€ä¹ˆä¼šæœ‰ä¿¡ä»»é—®é¢˜ï¼Ÿå›è°ƒçš„æœ¬è´¨å°±æ˜¯ç­‰å¾…å°†æ¥æ‰§è¡Œå®Œæˆçš„äº‹ä»¶æ¥æ‰§è¡Œæˆ‘ä»¬æ‰€å‡†å¤‡çš„å‡½æ•°ã€‚\n\n```js\n// A\najax('url.1', () => {\n  // B\n});\n// C\n```\n\nA ä¸ B éƒ¨åˆ†çš„å—æ˜¯åŒæ­¥çš„ï¼Œå‘ç”Ÿäºç°åœ¨ï¼Œåœ¨ JavaScript ä¸»ç¨‹åºçš„æ§åˆ¶ä¹‹ä¸‹ã€‚ä½† C ç¨‹åºå—å°†å»¶è¿Ÿæ‰§è¡Œï¼Œå¹¶ä¸”ç”±ï¼ˆè™šæ„çš„ï¼‰ajax å‡½æ•°æ¥è°ƒç”¨ã€‚è¿™å°±æ˜¯ä¸€ç§æ§åˆ¶è½¬ç§»ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¿™ç§æ§åˆ¶è½¬ç§»é€šå¸¸ä¸ä¼šç»™ç¨‹åºå¸¦æ¥ä»»ä½•é—®é¢˜ã€‚\n\nä½†å®é™…ä¸Šï¼Œå›è°ƒå¸¦æ¥çš„ä¿¡ä»»é—®é¢˜æ­£æ˜¯ç”±è¿™ç§æ§åˆ¶åè½¬ï¼ˆinversion of controlï¼‰å¸¦æ¥çš„ã€‚\n\n### å“ªäº›é—®é¢˜\n\nå¯¹äºå›è°ƒçš„ä¿¡ä»»é—®é¢˜ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š\n\n* è°ƒç”¨å›è°ƒè¿‡æ—©ï¼›\n* è°ƒç”¨å›è°ƒè¿‡æ™šï¼›\n* è°ƒç”¨å›è°ƒæ¬¡æ•°è¿‡å°‘æˆ–æˆ–å¤šï¼›\n* å‚æ•°/ç¯å¢ƒå€¼æœªä¼ é€’ï¼›\n* åæ‰å¯èƒ½å‡ºç°çš„é”™è¯¯æˆ–å¼‚å¸¸ï¼›\n\nç­‰ã€‚\n\näººä»¬ç”¨è™šæ„çš„æ¶é­” Zalgo æ¥æè¿°è¿™ç§åŒæ­¥/å¼‚æ­¥çš„å™©æ¢¦ï¼Œåœ¨ [Don't release Zalgo!](https://oren.github.io/articles/zalgo/) ä¸€æ–‡ä¸­ï¼Œé’ˆå¯¹å›è°ƒä¿¡ä»»é—®é¢˜çš„æè¿°ä¸ºï¼š\n\n> When you write a function that accept a callback, make sure your function always sync or always async. don't mix the two.\n\nå½“æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¥æ”¶å›è°ƒçš„å‡½æ•°æ—¶ï¼Œè¦ç¡®ä¿è¯¥å‡½æ•°æ‹¥æœ‰ä»¥å¼‚æ­¥æˆ–åŒæ­¥çš„æ–¹å¼è¿è¡Œï¼ŒäºŒè€…ä¸èƒ½æ··æ·†ã€‚å¦‚æœè¯¥å‡½æ•°è¿è¡Œçš„æ–¹å¼æ— æ³•ç¡®å®šï¼Œå°±ä¼šå‡ºç°å›è°ƒè¿‡æ—©ï¼Œè¿‡æ™šç­‰æƒ…å†µã€‚\n\nè¿™äº›æƒ…å†µä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿè¿™æ˜¯ä¸€æ®µä¼ªä»£ç ï¼š\n\n```js\nfunction result(data) {\n  console.log(a);\n}\n\nlet a = 0;\n\najax('url.1', result);\n\na++;\n```\n\nå‡è®¾è™šæ„çš„ ajax å‡½æ•°æ— æ³•ç¡®å®šå®ƒæ—¶åŒæ­¥æ‰§è¡Œï¼ˆä»ç¼“å­˜è¯»å–ï¼‰è¿˜æ˜¯å¼‚æ­¥æ‰§è¡Œï¼ˆå‘é€ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼‰ï¼Œè¿™å°±å¯¼è‡´äº† result å‡½æ•°æ‰“å° a çš„å€¼å˜çš„ä¸ç¡®å®šã€‚å¦‚æœæ˜¯åŒæ­¥çš„ï¼Œåˆ™ a = 0ï¼›åä¹‹ï¼Œa = 1ï¼›\n\nè¿™è¿˜åªæ˜¯å¤šä¸ªä¿¡ä»»é—®é¢˜ä¸­çš„ä¸€ä¸ªï¼Œåœ¨ JavaScript é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œå¯¹äºå¼‚æ­¥æ¥è¯´ï¼Œå›è°ƒå‡½æ•°å·²ç»ä¸å¤Ÿç”¨äº†ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´å¥½çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ï¼Œä¸€ç§æ›´åŒæ­¥ã€æ›´é¡ºåºã€æ›´é˜»å¡çš„æ–¹å¼æ¥è¡¨è¾¾å¼‚æ­¥ï¼Œå°±åƒæˆ‘ä»¬çš„å¤§è„‘ä¸€æ ·ã€‚\n\n## Promise\n\nES6 ä¸ºæˆ‘ä»¬å¸¦æ¥äº†æ–°çš„å¼‚æ­¥æ¦‚å¿µï¼Œå³ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¾®ä»»åŠ¡ï¼‰ã€‚Promise API å°±æ˜¯åŸºäºå¾®ä»»åŠ¡ä¹‹ä¸Šçš„ï¼Œå®ƒèƒ½å¤Ÿæ›´å¥½çš„å¤„ç†å›è°ƒæ‰€å¸¦æ¥çš„ä¿¡ä»»é—®é¢˜ã€‚\n\n> Promise æ˜¯ä¸€ä¸ªå¾ˆä¼˜ç§€çš„ APIï¼Œåˆ°å¤„éƒ½èƒ½çœ‹åˆ°å®ƒçš„è¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œä¾¿ä¸å†å¤šè´¹å£èˆŒã€‚\n\n### è°ƒç”¨è¿‡æ—©\n\næ ¹æ®ä¸Šè¿°çš„ Zalgo æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œè°ƒç”¨è¿‡æ—©ä¸»è¦çš„æ ¹æœ¬åŸå› å°±æ˜¯æˆ‘ä»¬æ— æ³•ç¡®å®šå›è°ƒå‡½æ•°æ˜¯ä»¥åŒæ­¥çš„æ–¹å¼è¿˜æ˜¯å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œçš„ã€‚è€Œ Promise æœ¬èº«å°±ä¸å¿…æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ï¼Œæ ¹æ®ä»»åŠ¡é˜Ÿåˆ—çš„å®šä¹‰ï¼Œå³ä¾¿æ˜¯ç«‹å³å®Œæˆçš„ Promise `Promise.resolve(42)` ä¹Ÿæ— æ³•è¢«åŒæ­¥æ‰€å¯Ÿè§‰åˆ°ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹ä¸€ä¸ª Promise è°ƒç”¨`then(...)`çš„æ—¶å€™ï¼Œå³ä½¿è¿™ä¸ª Promise å·²ç» resolveï¼Œæä¾›ç»™`then(...)`çš„å›è°ƒä¹Ÿæ€»æ˜¯ä¼šå¼‚æ­¥è°ƒç”¨ã€‚å› ä¸ºè¿™å°±æ˜¯å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡çš„è¿è¡Œæ–¹å¼ï¼š [ä»»åŠ¡ | ğŸ­Defectink](/defect/asynchronous-javascript-now-and-future.html#ä»»åŠ¡)\n\n```js\nconsole.log(41);\n\nPromise.resolve(42).then((val) => {\n  console.log(val);\n});\n\nconsole.log(43);\n// 41 43 42\n```\n\n### è°ƒç”¨è¿‡æ™š\n\nå’Œè°ƒç”¨è¿‡æ—©ç±»ä¼¼ï¼Œæ ¹æ®å¾®ä»»åŠ¡çš„å®šä¹‰ï¼Œä¸€ä¸ª Promise è¢« resolve æˆ–è€… reject åï¼Œä¸€å®šä¼šåœ¨å½“å‰å®ä»»åŠ¡åæ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚è¿™å°±ç¡®ä¿äº†æ³¨å†Œåœ¨ Promise ä¸Šçš„å›è°ƒåœ¨ä¸‹ä¸ªå®ä»»åŠ¡å¼€å§‹ä¹‹å‰ä¸€å®šä¼šè¢«ä¾æ¬¡è°ƒç”¨ï¼Œå¹¶ä¸”ä»–ä»¬ä¸­çš„ä»»æ„ä¸€ä¸ªéƒ½æ— æ³•å½±å“æˆ–å»¶è¯¯å¯¹å…¶ä»–å›è°ƒçš„è°ƒç”¨ã€‚\n\n```js\np.then((val) => {\n  p.then((val) => {\n    console.log('C');\n  });\n  console.log('A');\n});\np.then((val) => {\n  console.log('B');\n});\n// A B C\n```\n\nè¿™é‡Œçš„ä¸‰ä¸ªå¾®ä»»åŠ¡ï¼ŒC æ°¸è¿œæ— æ³•æ‰“æ–­æˆ–æŠ¢å  Bï¼Œè¿™æ˜¯å› ä¸º Promise çš„è¿ä½œæ–¹å¼ã€‚\n\n#### è°ƒåº¦æŠ€å·§\n\nå¾®ä»»åŠ¡è™½ç„¶ç»™æˆ‘ä»¬å¸¦æ¥äº†ä¸å°‘å¥½å¤„ï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šè°ƒåº¦çš„ç»†å¾®å·®åˆ«ã€‚å¦‚æœä¸¤ä¸ª Promise p1 å’Œ p2 éƒ½å·²ç» resolveï¼Œé‚£ä¹ˆæ³¨å†Œåœ¨ p1 ä¸Šçš„`then(...)`å›è°ƒé€šå¸¸åº”è¯¥å…ˆäº p2 æ‰€æ³¨å†Œçš„å›è°ƒæ‰§è¡Œã€‚ä½†æŸäº›ç»†å¾®çš„åœºæ™¯ä¸‹å¯èƒ½ä¸æ˜¯å¦‚æ­¤ï¼š\n\n```js\nconst p3 = new Promise((resolve) => {\n  resolve('B');\n});\nconst p1 = new Promise((resolve) => {\n  resolve(p3);\n});\nconst p2 = new Promise((resolve) => {\n  resolve('A');\n});\n\np1.then((val) => {\n  console.log(val);\n});\np2.then((val) => {\n  console.log(val);\n});\n// A B\n```\n\nç”±äº p1 ä¸æ˜¯ç«‹å³å€¼ï¼Œ è€Œæ˜¯ resolve å¦ä¸€ä¸ª Promise p3ã€‚è§„å®šçš„è¡Œä¸ºæ˜¯æŠŠ p3 å±•å¼€åˆ° p1ï¼Œä½†æ˜¯æ˜¯å¼‚æ­¥çš„å±•å¼€ï¼Œæ‰€ä»¥è¿™é‡Œçš„ p2 çš„å›è°ƒå…ˆæ‰§è¡Œã€‚\n\n> å¦‚æœ p1 æ˜¯`Promise.resolve()`ï¼Œç»“æœåˆ™ä¸åŒï¼Œå®ƒä¼šè¿”å›åŒä¸€ä¸ª Promiseã€‚\n\n### å›è°ƒæœªè°ƒç”¨\n\nç›®å‰æ²¡æœ‰ä»»ä½•åŠæ³•èƒ½å¤Ÿé˜»æ­¢ Promise å‘æˆ‘ä»¬é€šçŸ¥å®ƒçš„å†³è®®ï¼ˆresolve æˆ–è€… rejectï¼‰ã€‚å¦‚æœæˆ‘ä»¬å¯¹ Promise æ³¨å†Œäº†å›è°ƒçš„è¯ï¼Œé‚£ä¹ˆå®ƒåœ¨å†³è®®æ—¶ï¼Œæ€»æ˜¯ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼ˆå®Œæˆå›è°ƒæˆ–æ‹’ç»å›è°ƒä¸­çš„ä¸€ä¸ªï¼‰ã€‚\n\n> å†³è®®ä¸€è¯å‚è€ƒè‡ªã€Šä½ ä¸çŸ¥çš„ JavaScript ä¸­å·ã€‹ä¸­æ–‡ç‰ˆï¼Œè¿™ä¹Ÿæ˜¯æœ¬æ–‡å¯¹ Promise resolve æˆ– reject çš„è¡¨è¾¾è¯ã€‚\n\nä½†å¦‚æœå›è°ƒæ°¸è¿œä¸ä¼šè¢«å†³è®®å‘¢ï¼ŸPromise ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç«æ€çš„é«˜çº§æŠ½è±¡æœºåˆ¶çš„ APIï¼š`Promise.race()`ã€‚\n\n```js\nconst timeoutPromise = (delay) => {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      reject('Timeout!');\n    }, delay);\n  });\n};\n\n// å‡è®¾ foo ä¸ä¼šè¢«å†³è®®\n// å°è¯•ç»™å®ƒ 3000ms\nPromise.race([foo(), timeoutPromise(3000)])\n  .then((val) => {\n    console.log('foo done');\n  })\n  .catch((e) => {\n    console.log(e);\n  });\n```\n\nåˆ©ç”¨è¯¥ APIï¼Œå³ä¾¿ç›®æ ‡ Promise æ°¸è¿œä¸ä¼šè¢«å†³è®®ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ä¸ºå…¶è®¾ç½®è¶…æ—¶å¹¶é˜²æ­¢å®ƒæ°¸ä¹…é˜»å¡ç¨‹åºã€‚\n\n> è¿™é‡Œå¦‚æœ foo æ˜¯å¾®ä»»åŠ¡æ­»å¾ªç¯çš„è¯ï¼Œrace ä¹Ÿæ— èƒ½ä¸ºåŠ›ï¼\n\n### è°ƒç”¨æ¬¡æ•°è¿‡å°‘/è¿‡å¤š\n\næ­£å¸¸æƒ…å†µä¸‹çš„è°ƒç”¨æ¬¡æ•°åº”è¯¥æ˜¯ 1 æ¬¡ï¼Œè°ƒç”¨æ¬¡æ•°è¿‡å°‘ä¹Ÿå°±æ˜¯ 0 æ¬¡ï¼Œè¿™ä¸ä¸Šè¿°å›è°ƒæœªè°ƒç”¨æ˜¯ä¸€ä¸ªæ„æ€ã€‚å‰©ä¸‹çš„å°±æ˜¯è°ƒç”¨æ¬¡æ•°è¿‡å¤šäº†ã€‚\n\næœ¬è´¨ä¸Šï¼ŒPromise çš„å®šä¹‰æ–¹å¼ä½¿å¾—å®ƒåªèƒ½è¢«å†³è®®ä¸€æ¬¡ã€‚å¦‚æœå‡ºç°æŸç§æƒ…å†µï¼Œæˆ‘ä»¬çš„ä»£ç è¯•å›¾è°ƒç”¨`resolve(...)`æˆ–`reject(...)`å¤šæ¬¡ï¼Œæˆ–è€…è¯•å›¾äºŒè€…éƒ½è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ª Promise åªä¼šæ¥æ”¶ç¬¬ä¸€æ¬¡å†³è®®ï¼Œå¹¶é»˜é»˜çš„å¿½ç•¥åç»­çš„ä»»ä½•è°ƒç”¨ã€‚\n\nç”±äº Promise åªèƒ½è¢«å†³è®®ä¸€æ¬¡ï¼Œä»»ä½•é€šè¿‡`then(...)`æ³¨å†Œçš„å›è°ƒåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚è¿™æ˜¯åœ¨é“¾å¼è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œå¤šæ¬¡æ³¨å†Œ then å›è°ƒï¼ˆ`p.then(); p.then()`ï¼‰æ—¶ï¼Œå®ƒçš„è°ƒç”¨æ¬¡æ•°ä¸æ³¨å†Œæ¬¡æ•°ç›¸åŒã€‚\n\n### æœªèƒ½ä¼ é€’å‚æ•°/ç¯å¢ƒå€¼\n\nPromise æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå†³è®®å€¼ï¼Œå®Œæˆæˆ–æ‹’ç»ã€‚\n\nå¦‚æœæ²¡æœ‰æ‰‹åŠ¨å†³è®®ä»»ä½•å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±æ˜¯ undefinedã€‚å¦‚æœå†³è®®æ—¶ä¼ é€’äº†å¤šä¸ªå‚æ•°ï¼Œå‰©ä½™çš„å‚æ•°éƒ½ä¼šè¢«é»˜é»˜å¿½ç•¥ã€‚å¦‚æœéœ€è¦ä¼ é€’å¤šä¸ªå€¼ï¼Œåˆ™éœ€è¦å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ã€‚\n\nå¯¹äºç¯å¢ƒå€¼æ¥è¯´ï¼Œæˆ‘ä»¬æä¾›çš„å›è°ƒå‡½æ•°ä¾ç„¶å¯ä»¥è®¿é—®å¯¹åº”çš„ä½œç”¨åŸŸå’Œé—­åŒ…ã€‚\n\n### åæ‰é”™è¯¯æˆ–å¼‚å¸¸\n\nå¦‚æœæ‹’ç»ä¸€ä¸ª Promise å¹¶ç»™å‡ºä¸€ä¸ªç†ç”±ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±ä¼šä¼ ç»™æ‹’ç»å›è°ƒã€‚\n\nå¦‚æœ Promise åœ¨åˆ›å»ºæˆ–å†³è®®çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œé‚£è¿™ä¸ªé”™è¯¯å°±ä¼šè¢«æ•æ‰ï¼Œå¹¶ä¸”ä½¿è¿™ä¸ª Promise è¢«æ‹’ç»ã€‚\n\n```js\nconst p = new Promise((resolve, reject) => {\n  foo.bar(); // é”™è¯¯ï¼foo æœªå®šä¹‰\n  resolve(42);\n});\n\np.then(\n  (val) => {\n    console.log(val);\n  },\n  (err) => {\n    console.log(err); // åœ¨è¿™é‡Œæ•è·é”™è¯¯\n  }\n);\n```\n\nè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é˜²æ­¢ Zalgo å‡ºç°çš„æœºåˆ¶ã€‚`then(...)`å¯ä»¥æ³¨å†Œä¸¤ä¸ªå›è°ƒï¼Œä¸€ä¸ªæˆåŠŸæ—¶è°ƒç”¨ï¼Œä¸€ä¸ªå‡ºé”™æ—¶è°ƒç”¨ã€‚è¿™å’Œä»¥å‰å›è°ƒå‡½æ•°çš„æ–¹å¼å¥½ä¼¼ç›¸åŒã€‚ä½†å¦‚æœåœ¨å›è°ƒæœŸé—´å‡ºç°çš„é”™è¯¯å°±æ— æ³•è¢«å½“å‰`then(...)`ä¸­çš„å¦ä¸€ä¸ªå¤±è´¥å›è°ƒæ‰€æ•è·ï¼Œè¿™çœ‹ä¼¼é˜²æŠ¤å°±æ˜¯é”™è¯¯è¢«åæ‰äº†ã€‚å¥½åœ¨ï¼Œç°åœ¨çš„ Promise è¿˜æ”¯æŒå’Œ`try...catch...`ç±»ä¼¼çš„æ–¹å¼é˜²æ­¢åæ‰é”™è¯¯ã€‚\n\n```js\nconst p1 = new Promise((resolve) => {\n  resolve(42);\n});\n\np1.then((val) => {\n  foo.bar();\n  console.log(val);\n})\n  .catch((err) => {\n    console.log('Catch in catch');\n    console.log(err);\n  })\n  .finally(() => {\n    cleanFunc();\n  });\n```\n\n## æ˜¯å¯ä¿¡ä»»çš„Promiseå—\n\nPromise çœ‹ä¸Šå»è§£å†³äº†ä¸å°‘å›è°ƒæ— æ³•è¢«ä¿¡ä»»çš„é—®é¢˜ï¼Œé‚£ä¹ˆ Promise æ˜¯å®Œå…¨å¯ä¿¡çš„å—ï¼Ÿåœ¨æ­¤ä¹‹å‰ï¼Œå¾—å…ˆçœ‹å¦ä¸€ä¸ªé—®é¢˜ã€‚\n\n### thenable çš„é¸­å­ç±»å‹\n\n> å½“çœ‹åˆ°ä¸€åªé¸Ÿèµ°èµ·æ¥åƒé¸­å­ã€æ¸¸æ³³èµ·æ¥åƒé¸­å­ã€å«èµ·æ¥ä¹Ÿåƒé¸­å­ï¼Œé‚£ä¹ˆè¿™åªé¸Ÿå°±å¯ä»¥è¢«ç§°ä¸ºé¸­å­ã€‚\n\nå¸¸è§çš„ Promise éƒ½æ˜¯ç”±å…¶æ„é€ å‡½æ•°å®ä¾‹åŒ–è€Œæ¥ï¼Œæˆ–è®¸æˆ‘ä»¬å¯ä»¥é€šè¿‡`p instanceof Promise`æ¥æ£€æŸ¥æŸæ ·ä¸œè¥¿æ˜¯å¦æ˜¯çœŸæ­£çš„ Promiseã€‚ä½†è¿™ä¸ªæ–¹æ³•å¹¶ä¸å®Œå–„ï¼Œå¦‚æœ Promise æ¥è‡ªå…¶ä»–çª—å£æˆ–æŸä¸ªè‡ªå·±å®ç° Promise çš„åº“ä¸­ï¼Œæˆ‘ä»¬å°±æ— æ³•åˆ¤æ–­å…¶æ˜¯å¦æ˜¯çœŸæ­£å¯ç”¨çš„ Promiseã€‚\n\nä¾‹å¦‚è¿™æ ·çš„ thenable ç±»å‹å¯¹è±¡ï¼Œå®ƒå¯èƒ½ç±»ä¼¼äº Promise çš„æ–¹å¼å·¥ä½œå®Œå…¨å°±æ˜¯ä¾¥å¹¸ã€‚\n\n```js\nconst p = {\n  then(cb, ecb) {\n    cb(42);\n  },\n};\n\np.then((val) => {\n  console.log(val); // 42\n});\n```\n\nå¦‚æœæƒ…å†µæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆåœ¨ thenable çš„å¯¹è±¡ä¸Šæ³¨å†Œçš„å›è°ƒéƒ½ä¼šè¢«æ‰§è¡Œï¼Œè¿™æ ·çš„è¡Œä¸ºå’Œ Promise å®Œå…¨ä¸ä¸€è‡´ã€‚\n\n```js\nconst p = {\n  then(cb, ecb) {\n    cb(42);\n    ecb('evil laugh');\n  },\n};\n\np.then(\n  (val) => {\n    console.log(val); // 42\n  },\n  (err) => {\n    console.log(err); // åŒæ ·ä¹Ÿè¢«æ‰§è¡Œäº†ï¼\n  }\n);\n```\n\nå¥½åœ¨ï¼ŒPromise ç»™äº†æˆ‘ä»¬è§£å†³åŠæ³•ï¼š`Promise.resolve()`ã€‚`Promise.resolve()`å¯ä»¥æ¥æ”¶ä»»ä½• thenable çš„å€¼ï¼Œå°†å…¶è§£å°ä¸ºå®ƒçš„é thenable å€¼ã€‚ä»`Promise.resolve()`å¾—åˆ°çš„å€¼å°†æ˜¯ä¸€ä¸ªçœŸæ­£çš„ Promiseã€‚\n\n```js\nPromise.resolve(p).then(\n  (val) => {\n    console.log(val); // 42\n  },\n  (err) => {\n    console.log(err); // æ²¡æœ‰è¢«æ‰§è¡Œï¼\n  }\n);\n```\n\næ‰€ä»¥åœ¨é¢å¯¹æ— æ³•ä¿¡ä»»çš„ Promise æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`Promise.resolve()`å¯¹å…¶è¿›è¡Œå°è£…ï¼Œå°†å…¶å˜æˆçœŸæ­£çš„ Promiseã€‚\n\n### å¦å¤–çš„è°ƒåº¦æŠ€å·§\n\nåœ¨ä¸Šè¿°è°ƒåº¦æŠ€å·§ä¸­ï¼Œp1 å¦‚æœ resolve p3ï¼Œåˆ™éœ€è¦åœ¨ä¸‹ä¸€ä¸ªå¼‚æ­¥ä¸­å°†å…¶å±•å¼€ã€‚\n\n```js\nconst p3 = new Promise((resolve) => {\n  resolve('B');\n});\nconst p1 = new Promise((resolve) => {\n  resolve(p3);\n});\n\np1.then((val) => {\n  console.log(val);\n});\n```\n\nè€Œä½¿ç”¨`Promise.resolve()`åˆ™ä¼šç«‹å³è¿”å›ä¸€ä¸ªç›¸åŒçš„ Promiseã€‚\n\n```js\nconst p3 = new Promise((resolve) => {\n  resolve(42);\n});\n\nconst p1 = Promise.resolve(p3);\n\nconsole.log(p1 === p3); // true\n```\n\n","desc":"ç»§å‰ç¯‡ å¼‚æ­¥JavaScript-ç°åœ¨ä¸å°†æ¥ | ğŸ­Defectink å¯¹å¼‚æ­¥ JavaScript æœ‰äº†ä¸ªå¤§æ¦‚çš„äº†è§£ä¹‹åï¼Œå°±è¦æ¥çœŸæ­£çš„ä¸Šæ‰‹ä¸€ä¸‹ Promise äº†ã€‚ä½†åœ¨äº†è§£ Promise è§£å†³äº†...","title":"å¼‚æ­¥JavaScript-Promiseä¿¡ä»»é—®é¢˜","date":"2021-07-16T18:50:04.000Z","tags":"JavaScript","categories":"ç¬”è®°","url":"asynchronous-javascript-trust-promise"}},"__N_SSG":true}